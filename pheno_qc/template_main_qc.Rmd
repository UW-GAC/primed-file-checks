---
title: "PRIMED QC Report"
author: "PRIMED CC"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    toc: true
params: 
  tables: ""
  path: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(knitr)
library(ggplot2)
```

This document performs QC checks on PRIMED phenotypes. Specific checks are determined through a collaborative effort between PRIMED WGs and the CC. The QC report is formatted as follows: 

  - Variable: name of variable  
  - Min: minumum observed value
  - Max: maximum observed value
  - Mean: mean observed value
  - Median: median observed value
  - QC Min: minimum threshold for QC
  - QC Max: maximum threshold for QC
  - Pass QC: number of samples within the set min and max
  - Fail QC Min: number of samples with variables under min value
  - Fail QC Max: number of samples with variables over max value
  - Null Values: number of samples with null values for this variable 

```{r params}
# parameters <- list(tables=table_files, path=filepath)
# table_files is a two column tsv file with (table_names, file_names)

child_document <- "template_general_qc.Rmd" # the child doc will be the general qc Rmd

grandchild_document_table_names <- params$tables$table_names
grandchild_document_file_names <- params$tables$file_names
```

```{r call_child_rmd, results='asis'}
# Call child document for general QC check 
# This chunk will loop through the list of table names to be QC'd 

res <- vector(mode = "list", length = length(grandchild_document_table_names))

for (i in 1:length(grandchild_document_table_names)) {
  grandchild_document_table_name <- grandchild_document_table_names[i]
  grandchild_document_file_name <- grandchild_document_file_names[i]
  
  res[[i]] <- knitr::knit_child(child_document, quiet = TRUE, envir = environment())
}

cat(unlist(res), sep = '\n')
```